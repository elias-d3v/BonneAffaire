{% extends 'base.html.twig' %}

{% block body %}
<section class="page-banner">
  <h1>D√©tail de l'annonce</h1>
</section>

<div class="post-show">

  {# Slider images #}
  <div class="post-slider-container">
    <div class="slick-slider">
      {% if post.image1 %}
        <div><img src="{{ asset('uploads/' ~ post.image1) }}" alt="{{ post.title }}"></div>
      {% endif %}
      {% if post.image2 %}
        <div><img src="{{ asset('uploads/' ~ post.image2) }}" alt="{{ post.title }}"></div>
      {% endif %}
      {% if post.image3 %}
        <div><img src="{{ asset('uploads/' ~ post.image3) }}" alt="{{ post.title }}"></div>
      {% endif %}
    </div>

    <button class="favorite-btn"
        data-url="{{ path('favorites_toggle', {id: post.id}) }}"
        data-favorited="{{ post.id in favorisIds ? 'true' : 'false' }}">
        <img src="{{ asset(post.id in favorisIds
            ? 'images/hearth-fill.svg'
            : 'images/hearth-svgrepo-com.svg') }}" alt="favori">
    </button>
  </div>

  {# Infos principales #}
  <div class="post-header">
    <h1>{{ post.title }}</h1>
    <p class="category">{{ post.category.name }}</p>
    <p class="price">{{ post.price }} ‚Ç¨</p>
    <p class="date">
      Publi√© le {{ post.publishedAt|date('d/m/Y √† H:i') }}
    </p>
  </div>

  {# Vendeur #}
  <div class="seller-card">
    <div class="seller-info">
        <img src="{{ asset(post.user.avatarPath) }}" class="avatar" alt="Profil">
      <div>
        <p class="seller-name">{{ post.user.name }}</p>
        <p class="seller-rating">‚≠ê 4,9 / 5</p>
      </div>
    </div>
    {% if app.user and app.user != post.user %}
      <a href="#" class="btn btn-contact" data-open="contactModal">Contacter le vendeur</a>
    {% endif %}
  </div>

  <div class="post-meta-box">
    {# Localisation et √©tat #}
    <div class="post-meta">
      <p><strong>Lieu :</strong> <span style="font-weight:500">{{ post.location }} ({{ post.postalCode }})</span></p>
      <p><strong>√âtat :</strong> <span style="font-weight:500">{{ post.itemCondition }}</span></p>
    </div>

    {# Description #}
    <div class="post-description">
      <h3>Description :</h3>
      <p>{{ post.description }}</p>
    </div>
  </div>

  {# Actions secondaires #}
  <div class="post-actions">
      <div class="action-col">
          <a href="#" class="btn btn-report" data-open="reportModal">üö© Signaler</a>
      </div>
      <div class="action-col">
          {% if app.user and (app.user == post.user or 'ROLE_ADMIN' in app.user.roles) %}
              <a href="{{ path('post_edit', {id: post.id}) }}" class="btn btn-edit">‚úèÔ∏è Modifier</a>
          {% endif %}
      </div>
  </div>

{# --- Modale Signalement --- #}
<div class="modal" id="reportModal">
  <div class="modal-content">
    <h2>üö© Signaler cette annonce</h2>
    <p>√ätes-vous s√ªr de vouloir signaler cette annonce ?</p>
    <div class="modal-actions">
      <button class="btn btn-secondary" data-close>Annuler</button>
      <a href="{{ path('report_post', {id: post.id}) }}" class="btn btn-danger">Confirmer</a>
    </div>
  </div>
</div>

{# --- Modale Contact --- #}
<div class="modal" id="contactModal">
  <div class="modal-content">
    <h2>‚úâÔ∏è Contacter {{ post.user.name }}</h2>
    <form method="post" action="{{ path('message_contact', {id: post.id}) }}">
      <textarea name="content" class="form-control" rows="5">
Bonjour {{ post.user.name }}, je suis int√©ress√© par votre annonce. Cordialement, {{ app.user.name }}</textarea>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" data-close>Annuler</button>
        <button type="submit" class="btn btn-primary">Envoyer</button>
      </div>
    </form>
  </div>
</div>

<!-- Nouveaut√©s -->
  <section class="news">
    <h2 class="title">Nouveaut√©s</h2>
    <div class="grid">
      {% for post in last_posts %}
        {% if post.status == 'validated' %}
          <article class="card">
            <a href="{{ path('post_show', {id: post.id}) }}" class="card-link">
              <button 
                  class="favorite-btn"
                  data-url="{{ path('favorites_toggle', {id: post.id}) }}"
                  data-favorited="{{ post.id in favorisIds ? 'true' : 'false' }}"
              >
                  <img src="{{ asset(post.id in favorisIds 
                      ? 'images/hearth-fill.svg' 
                      : 'images/hearth-svgrepo-com.svg') }}" alt="favori">
              </button>

              <img src="{{ asset('uploads/' ~ post.image1) }}" alt="{{ post.title }}">
              <h3>{{ post.title }}</h3>
              <p>{{ post.price }} ‚Ç¨</p>
              <span>{{ post.location }}</span>
              <span class="date">08/09/2025 √† 21h19</span>
            </a>
          </article>
        {% endif %}
      {% else %}
        <p>Aucune annonce pour le moment</p>
      {% endfor %}

      <div class="see-more">
        <a href="{{ path('post_list') }}" class="btn">Voir plus</a>
      </div>
    </div>
  </section>
{% endblock %}
