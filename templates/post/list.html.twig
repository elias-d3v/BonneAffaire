{% extends 'base.html.twig' %}

{% block body %}
<h1>Liste des annonces</h1>

<form method="get" action="{{ path('post_list') }}" class="mb-4">

    <select name="sort" class="form-select" onchange="this.form.submit()">
        <option value="date" {{ sort is defined and sort == 'date' ? 'selected' : '' }}>Trier par date</option>
        <option value="prix" {{ sort is defined and sort == 'prix' ? 'selected' : '' }}>Trier par prix</option>
    </select>

    <!-- Cat√©gories -->
    <select name="category" onchange="this.form.submit()">
      <option value="">-- Toutes cat√©gories --</option>
      {% for cat in categories %}
        <option value="{{ cat.id }}" {{ selectedCategory == cat.id ? 'selected' }}>
          {{ cat.name }}
        </option>
      {% endfor %}
    </select>

    <!-- D√©partement -->
    <input type="text" name="dept" value="{{ selectedDept }}" placeholder="D√©partement (ex: 75)" size="5">
    <button type="submit">Filtrer</button>
</form>

{% for post in posts %}
  <div class="card" style="margin-bottom: 20px; padding: 10px; border: 1px solid #ccc;">
    <h2>
      <a href="{{ path('post_show', {id: post.id}) }}">
        {{ post.title }}
      </a>
    </h2>
    <p>Prix : {{ post.price }} ‚Ç¨</p>
    <p>Lieu : {{ post.location }} - {{ post.postalCode }}</p>
    <p>Cat√©gorie : {{ post.category.name }}</p>
    <p>Publi√© par {{ post.user.name }}</p>

    {# Images #}
    {% if post.image1 %}
      <img src="{{ asset('uploads/' ~ post.image1) }}" width="150">
    {% endif %}
    {% if post.image2 %}
      <img src="{{ asset('uploads/' ~ post.image2) }}" width="150">
    {% endif %}
    {% if post.image3 %}
      <img src="{{ asset('uploads/' ~ post.image3) }}" width="150">
    {% endif %}

    {% if app.user and (app.user == post.user or 'ROLE_ADMIN' in app.user.roles) %}
      <a href="{{ path('post_edit', {id: post.id}) }}">Modifier l‚Äôannonce</a>
    {% endif %}

    <a href="{{ path('favorites_add', {id: post.id}) }}" class="btn btn-warning">‚≠ê Ajouter aux favoris</a>
    <a href="{{ path('report_post', {id: post.id}) }}" class="btn btn-danger">üö© Signaler cette annonce</a>
  </div>
  
{% else %}
  <p>Aucune annonce disponible.</p>
{% endfor %}
{% endblock %}
